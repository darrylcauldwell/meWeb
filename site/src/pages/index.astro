---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/PostCard.astro';
import Pagination from '../components/Pagination.astro';

const allPosts = await getCollection('post', ({ data }) => !data.draft);
const sortedPosts = allPosts.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Pagination
const postsPerPage = 10;
const totalPages = Math.ceil(sortedPosts.length / postsPerPage);
const currentPage = 1;
const paginatedPosts = sortedPosts.slice(0, postsPerPage);
---

<BaseLayout title="Darryl Cauldwell" description="Personal site with technical articles">
  <div class="max-w-[var(--max-width)] mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <main class="max-w-3xl mx-auto">
      <div class="space-y-6">
        {paginatedPosts.map((post) => (
          <PostCard
            title={post.data.title}
            description={post.data.description}
            date={post.data.date}
            category={post.data.category}
            slug={post.id}
          />
        ))}
      </div>

      <Pagination
        currentPage={currentPage}
        totalPages={totalPages}
        baseUrl="/"
        paginatedPath="/post/"
      />
    </main>
  </div>
</BaseLayout>
